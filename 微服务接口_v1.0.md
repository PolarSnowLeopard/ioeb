# 微服务组合

共有四个系统，每个系统中抽取需要的部分，组合成一个新的“智能装备学习与成绩综合评价”微服务。仅供原型开发。

在下图中，微服务熔断、注册中心和网关都是已经开发好的基础设施，我们只需要从每个系统中抽调出一个微服务进行组合、开发。

![image-20201111101940212](.\combination.png)

## 系统：视频教学系统

### 微服务：学生成绩记录

#### 接口：某学生视频观看情况

描述：获取某个学生的视频观看情况

请求地址：${url}/api/videoRecord

请求类型：GET

| 请求参数   | 描述                                 | 是否必须 | 默认值                             |
| ---------- | ------------------------------------ | -------- | ---------------------------------- |
| student_id | 学生表中的主键id                     | 是       | 无                                 |
| category   | 视频的种类（无人机、挖掘机、大飞机） | 否       | 1（1为无人机，category应该自定义） |

返回结果：

```json
{
    "video_sum": 5,	// 某种智能装备一共有多少视频
    "finished_video": "3"  //学生已经看完了几个视频
    "detail": [			//该种类下每种视频的观看情况
    	{
    		"video_id": 1000 //视频id
    		"total_time": 3600 //视频总时长，单位：秒
    		"last_watched": 1800 //上次看到了哪儿，单位：秒
    		"finished": true //是否看完
    	},
        {
    		...
    	}
    ]
}
```

## 系统：智能装备系统

### 微服务：学生成绩记录

#### 接口：某学生智能装备操作情况

描述：获取某个学生对该智能装备的操作情况(需要根据具体的装备完善response)

请求地址：${url}/api/optRecord

请求类型：GET

请求参数: 

| 请求参数   | 描述             | 是否必须 | 默认值 |
| ---------- | ---------------- | -------- | ------ |
| student_id | 学生表中的主键id | 是       | 无     |

返回结果：

```json
{
    "time": 300,	// 操作时长，单位：秒
    "max_speed": 30  //操作过程中的最大速度，单位：km/h
    "crash_time": 5 //碰撞次数
}
```

## 系统：状态检测系统

### 微服务：学生成绩记录

#### 接口：获取学生上课的专注度

描述：获取某个学生上课时的平均专注度

请求地址：${url}/api/concentrationRecord

请求类型：GET

请求参数: 

| 请求参数   | 描述             | 是否必须 | 默认值 |
| ---------- | ---------------- | -------- | ------ |
| student_id | 学生表中的主键id | 是       | 无     |

返回结果：

```json
{
    "score": 76,	// 学生上课的专注度 
}
```

## 系统：日报系统

### 微服务：学生成绩记录

#### 接口：获取学生对智能装备的总体掌握情况 

描述：获取某个学生对智能装备的总体掌握情况 ，该服务会依次调用上面三个微服务的接口并且组合起来返回成绩

请求地址：${url}/api/totalScore

请求类型：GET

请求参数: 

| 请求参数   | 描述             | 是否必须 | 默认值 |
| ---------- | ---------------- | -------- | ------ |
| student_id | 学生表中的主键id | 是       | 无     |

返回结果：

```json
{
    "video_score": 50,	// 视频观看分数
    "opt_score": 50  //学生的操作分数
    "concentration_score": 50 //学生的上课专注度分数
    "total_grade": 50 //学生的总分数，计算公式暂屈上面三个指标的加权平均(0.3,0.5,0.2)
}
```

# 系统：无人机系统

### 接口： 获取教学档案里的教学轨迹

描述：根据考试id获取轨迹信息和教学元信息

地址：`/api/aircraft/trace`

请求类型：`GET`

请求参数：

| 参数名称 | 描述             | 是否必须 | 默认值 |
| -------- | ---------------- | -------- | ------ |
| exam_id  | 考试表中的主键id | 是       | 无     |

返回结果：

```json
{
  "student_name": '宋杰',
  "student_school": '复旦大学',
  "exam_course": '航线飞行', //考试（教学）科目，目前只考虑航线飞行
  "exam_requirement": 'rectangle', //轨迹的具体种类，矩形/s形/8字形
  "exam_room": "0001-复旦南区足球场", //考试（教学场地）
  "result": "通过", //是否通过
  "start_time": 157875413, // 时间戳
  "duration": 120, //持续时间，单位：秒
  "trace": [
    [],[],[],[]
  ] //描述轨迹的经纬度数组
}
```

### 接口： 获取全部教学档案

描述：教学档案以每次教学为基本单位，获取全部的教学信息，以后可以做分页

地址：`/api/aircraft/record`

请求类型：`GET`

请求参数：

返回结果：

```json
{
    "total_count": '2',	
    "value": [
        {
            "student_name": "宋杰",
            "exam_course": "航线飞行",
            "result": "通过",
            "start_time": 157875413 // 考试时间
    		"exam_room": "0001-复旦南区足球场" //考场（教学场地）
            "test_id": 1 //考试的id
        },
        {
            "student_name": "宋杰",
            "exam_course": "航线飞行",
            "result": "通过",
            "start_time": 157875413 // 考试时间
    		"exam_room": "0001-复旦南区足球场" //考试（教学场地）
            "test_id": 1 //考试的id
        }
    ]
}
```

